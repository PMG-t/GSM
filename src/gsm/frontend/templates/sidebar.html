<head>
    <title>GMS</title>

    <link rel="stylesheet" href="/static/css/sidebar.css">
</head>

<div class="sidebar">

    <h5 class="mb-4">
        Rumori Sinistri DB
        <span style="color: #e71945;">â˜…</span>
    </h5>

    <hr>
    
    <!-- Sistema: Database & Utente -->
    <div class="section mb-3">
        <h6 class="section-name text-muted">Configurazione</h6>
        
        <a href="{{ url_for('index') }}" class="system-info-link text-decoration-none d-block py-2" title="Cambia impostazioni">
            <div class="d-flex justify-content-between align-items-center px-2">
                <small class="text-muted">DB:</small>
                <strong id="sidebarDbName" class="system-value">-</strong>
            </div>
            <div class="d-flex justify-content-between align-items-center px-2 mt-1">
                <small class="text-muted">User:</small>
                <small id="sidebarUserName" class="system-value">-</small>
            </div>
        </a>
    </div>

    <hr>

    <!-- <div class="section mb-3">
        <h6 class="section-name text-muted">Generale</h6>
        <nav class="nav flex-column">
            <a class="nav-link {% if request.endpoint == 'index' %}active{% endif %}" href="{{ url_for('index') }}">Home</a>
        </nav>
    </div> -->

    <div class="section mb-3">
        <h6 class="section-name text-muted">Persone</h6>
        <nav class="nav flex-column">
            <a class="nav-link {% if request.endpoint == 'persone' %}active{% endif %}" href="{{ url_for('persone') }}">Persone</a>
        </nav>

        <nav class="nav flex-column">
            <a class="nav-link {% if request.endpoint == 'servizi' %}active{% endif %}" href="{{ url_for('servizi') }}">Servizi</a>
        </nav>

        <nav class="nav flex-column">
            <a class="nav-link {% if request.endpoint == 'bisogni' %}active{% endif %}" href="{{ url_for('bisogni') }}">Bisogni</a>
        </nav>

        <nav class="nav flex-column">
            <a class="nav-link {% if request.endpoint == 'aggiornamenti' %}active{% endif %}" href="{{ url_for('aggiornamenti') }}">Aggiornamenti</a>
        </nav>

    </div>

    <div class="section mb-3">
        <h6 class="section-name text-muted">Strumenti</h6>
        
         <nav class="nav flex-column">
            <a class="nav-link {% if request.endpoint == 'report' %}active{% endif %}" href="{{ url_for('report') }}">Report</a>
        </nav>

         <nav class="nav flex-column">
            <a class="nav-link {% if request.endpoint == 'import_page' %}active{% endif %}" href="{{ url_for('import_page') }}">Importa Dati</a>
        </nav>

    </div>
    
</div>

<script>
// Mostra il nome del database e utente corrente nella sidebar
fetch('/api/current-db')
    .then(res => res.json())
    .then(data => {
        const dbNameEl = document.getElementById('sidebarDbName');
        if (data.success && data.db_name) {
            dbNameEl.textContent = data.db_name;
        } else {
            dbNameEl.textContent = 'non impostato';
            dbNameEl.style.fontStyle = 'italic';
            dbNameEl.style.opacity = '0.6';
        }
    })
    .catch(err => {
        console.error('Error fetching current DB:', err);
        document.getElementById('sidebarDbName').textContent = 'errore';
    });

fetch('/api/current-user')
    .then(res => res.json())
    .then(data => {
        const userNameEl = document.getElementById('sidebarUserName');
        if (data.success && data.username) {
            userNameEl.textContent = data.username;
        } else {
            userNameEl.textContent = 'ospite';
            userNameEl.style.fontStyle = 'italic';
            userNameEl.style.opacity = '0.6';
        }
    })
    .catch(err => {
        console.error('Error fetching current user:', err);
    });
</script>